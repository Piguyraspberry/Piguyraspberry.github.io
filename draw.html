<!DOCTYPE html>
<html>
<head>
    <title>Simple Drawing App</title>
    <style>
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <canvas id="drawingCanvas" width="680" height="680"></canvas>

    <button id="blackMarker">Black Marker</button>
    <button id="redMarker">Red Marker</button>
    <button id="blueHighlighter">Blue Highlighter</button>
    <button id="eraser">Eraser</button>
    <button id="clear">Clear</button>

    <label for="sizeSlider">Size:</label>
    <input type="range" id="sizeSlider" min="1" max="10" value="2" />

    <button id="downloadImage">Download Image</button>

    <script>
        var canvas = document.getElementById('drawingCanvas');
        var ctx = canvas.getContext('2d');

        var isDrawing = false;
        var lastX = 0;
        var lastY = 0;
        var currentColor = 'black';
        var currentTool = 'marker';
        var currentSize = 2;
        
        ctx.lineJoining = "round";
        ctx.lineCap = "round";

        ctx.crossOrigin = '*'; 

        // Create a new image element
        const backgroundImage = new Image();

        // Set the source of the image
        backgroundImage.src = 'https://www.w3schools.com/w3css/img_lights.jpg';

        // Wait for the image to load
        backgroundImage.onload = function() {
            // Draw the image as the background
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
        };

        function startDrawing(e) {
            isDrawing = true;
            lastX = e.offsetX;
            lastY = e.offsetY;
        }

        function draw(e) {
            if (!isDrawing) return;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            ctx.stroke();
            ctx.closePath();

            lastX = e.offsetX;
            lastY = e.offsetY;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function setColor(color) {
            currentColor = color;
        }

        function setTool(tool) {
            currentTool = tool;

            if (tool === 'highlighter') {
                ctx.strokeStyle = 'rgba(0, 0, 255, 0.5)'; // Set the color to blue with transparency
                ctx.lineWidth = 2; // Set the line width to make it taller
                ctx.globalAlpha = 0.25;
            } else if (tool === 'eraser') {
                ctx.globalCompositeOperation = "destination-out";
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 1;
                ctx.globalAlpha = 1;
            } else {
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1;
                ctx.globalAlpha = 1;
            }
        }

        function setSize(size) {
            currentSize = size;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        document.getElementById('blackMarker').addEventListener('click', function() {
            setColor('black');
            setTool('marker');
        });

        document.getElementById('redMarker').addEventListener('click', function() {
            setColor('red');
            setTool('marker');
        });

        document.getElementById('blueHighlighter').addEventListener('click', function() {
            setColor('blue');
            setTool('highlighter');
        });

        document.getElementById('eraser').addEventListener('click', function() {
            setColor('white');
            setTool('eraser');
        });

        document.getElementById('clear').addEventListener('click', clearCanvas);

        var sizeSlider = document.getElementById('sizeSlider');
        sizeSlider.addEventListener('input', function() {
            setSize(this.value);
        });

        document.getElementById('downloadImage').addEventListener('click', function() {
            var image = canvas.toDataURL("image/png");
            var link = document.createElement('a');
            link.download = 'drawing.png';
            link.href = image;
            link.click();
        });
    </script>
</body>
</html>